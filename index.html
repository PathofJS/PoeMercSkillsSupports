<html>
<head>
    <title>Mercenary Skills</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #f0e6d2;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .container {
            background-color: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
        }
        h1 {
            color: #ffe066;
            text-align: center;
            margin-bottom: 25px;
            font-size: 2em;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #bfa76a;
        }
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #3a3a3a;
            color: #f0e6d2;
            font-size: 1em;
            appearance: none; /* Remove default arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23f0e6d2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13.2-6.4H18.4c-5%200-9.3%201.8-13.2%206.4-3.9%204.6-5.8%2010-5.8%2016v148.8c0%206%201.9%2011.4%205.8%2016s8.2%206.4%2013.2%206.4h255.4c5%200%209.3-1.8%2013.2-6.4s5.8-10%205.8-16V85.4c0-6-1.9-11.4-5.8-16z%22%2F%3E%3Cpath%20fill%3D%22%231a1a1a%22%20d%3D%22M243.6%20114.4L146.2%20211.8c-1.8%201.8-4.2%202.7-6.6%202.7s-4.8-.9-6.6-2.7L45.4%20114.4c-3.6-3.6-3.6-9.4%200-13s9.4-3.6%2013%200L146.2%20192.2l87.8-87.8c3.6-3.6%209.4-3.6%2013%200s3.6%209.4%200%2013z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
        }
        .skill-details, .support-details {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #444;
        }
        .skill-details h2, .support-details h2 {
            color: #ffe066;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .skill-description {
            font-style: italic;
            color: #ccc;
            margin-bottom: 10px;
        }
        .support-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .support-list li {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #444;
        }
        .support-list li:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .support-name {
            font-weight: bold;
            color: #bfa76a;
        }
        .support-description {
            color: #ccc;
            font-size: 0.9em;
        }
        .no-supports {
            color: #888;
            font-style: italic;
        }
        .error-message {
            color: #ff6666;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }
        /* New styles for the support gem selection group */
        .support-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .support-select-wrapper {
            flex: 1;
            min-width: 200px; /* Adjust as needed for responsiveness */
        }
        @media (max-width: 600px) {
            .support-group {
                flex-direction: column;
            }
            .support-select-wrapper {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Skill and Support Gem Selector</h1>

        <div class="form-group">
            <label for="skillSelect">Select a Skill:</label>
            <select id="skillSelect">
                <option value="">Loading skills...</option>
            </select>
        </div>

        <div id="skill-description-display" class="skill-details">
            <h2>Skill Description</h2>
            <p id="skill-description-text" class="skill-description">Select a skill from the dropdown to see its details.</p>
        </div>

        <div class="support-group">
            <div class="support-select-wrapper">
                <label for="support1">Support Gem 1:</label>
                <select id="support1" class="support-gem-select">
                    <option value="">-- Select Support --</option>
                </select>
            </div>
            <div class="support-select-wrapper">
                <label for="support2">Support Gem 2:</label>
                <select id="support2" class="support-gem-select">
                    <option value="">-- Select Support --</option>
                </select>
            </div>
            <div class="support-select-wrapper">
                <label for="support3">Support Gem 3:</label>
                <select id="support3" class="support-gem-select">
                    <option value="">-- Select Support --</option>
                </select>
            </div>
        </div>

        <div id="selected-supports-display" class="support-details">
            <h2>Selected Supports</h2>
            <div id="support-list-display" class="support-list">
                <p class="no-supports">No supports selected.</p>
            </div>
        </div>
    </div>

    <script>
        let supportGems = [];
        let skills = [];
        let currentPossibleSupports = [];

        const skillSelect = document.getElementById('skillSelect');
        const skillDescriptionText = document.getElementById('skill-description-text');
        const supportSelects = [
            document.getElementById('support1'),
            document.getElementById('support2'),
            document.getElementById('support3')
        ];
        const supportListDisplay = document.getElementById('support-list-display');

        // Function to populate the skill select dropdown
        function populateSkillSelect() {
            skillSelect.innerHTML = '<option value="">-- Select a Skill --</option>'; // Add a default option
            skills.forEach(skill => {
                const option = document.createElement('option');
                option.value = skill._index; // Use _index for skill value
                option.textContent = skill.Name;
                skillSelect.appendChild(option);
            });
        }

        // Function to populate a single support dropdown
        function populateSupportSelect(selectElement, availableSupports, selectedValues) {
            const currentSelectedValue = selectElement.value; // Preserve current selection if possible
            selectElement.innerHTML = '<option value="">-- Select Support --</option>'; // Add a default option

            availableSupports.forEach(supportIndex => {
                // Find support gem by _index
                const supportGem = supportGems.find(gem => gem._index === supportIndex);
                if (supportGem) {
                    const option = document.createElement('option');
                    option.value = supportGem._index; // Use _index for support value
                    option.textContent = supportGem.Name;

                    // Disable if already selected in another dropdown
                    if (selectedValues.includes(supportGem._index.toString()) && supportGem._index.toString() !== currentSelectedValue) {
                        option.disabled = true;
                    }
                    selectElement.appendChild(option);
                }
            });

            // Re-select the value if it's still valid
            // Check if currentSelectedValue is not empty, is in availableSupports, and is not selected by another dropdown
            if (currentSelectedValue && availableSupports.includes(parseInt(currentSelectedValue)) && !selectedValues.filter(val => val !== currentSelectedValue).includes(currentSelectedValue)) {
                selectElement.value = currentSelectedValue;
            } else {
                selectElement.value = ""; // Clear if previously selected value is no longer valid or is now disabled
            }
        }

        // Function to update all support dropdowns based on selections
        function updateSupportDropdowns() {
            const selectedSupportValues = supportSelects.map(select => select.value).filter(value => value !== "");

            supportSelects.forEach(selectElement => {
                populateSupportSelect(selectElement, currentPossibleSupports, selectedSupportValues);
            });

            // Update the display of selected support gem descriptions
            updateSelectedSupportsDisplay();
        }

        // Function to update the display of selected support gem descriptions
        function updateSelectedSupportsDisplay() {
            supportListDisplay.innerHTML = ''; // Clear previous content

            const selectedSupportIds = supportSelects.map(select => select.value).filter(id => id !== "");

            if (selectedSupportIds.length === 0) {
                supportListDisplay.innerHTML = '<p class="no-supports">No supports selected.</p>';
                return;
            }

            const ul = document.createElement('ul');
            selectedSupportIds.forEach(id => {
                // Find support gem by _index
                const support = supportGems.find(s => s._index == id);
                if (support) {
                    const li = document.createElement('li');
                    const supportName = document.createElement('div');
                    supportName.classList.add('support-name');
                    supportName.textContent = support.Name;
                    const supportDesc = document.createElement('div');
                    supportDesc.classList.add('support-description');
                    supportDesc.textContent = support.Description;
                    li.appendChild(supportName);
                    li.appendChild(supportDesc);
                    ul.appendChild(li);
                }
            });
            supportListDisplay.appendChild(ul);
        }

        // Event listener for skill selection change
        skillSelect.addEventListener('change', () => {
            const selectedSkillIndex = skillSelect.value;
            const selectedSkill = skills.find(skill => skill._index === parseInt(selectedSkillIndex));

            if (selectedSkill) {
                skillDescriptionText.textContent = selectedSkill.Description;
                if (selectedSkill.PossibleSupports) {
                    currentPossibleSupports = selectedSkill.PossibleSupports.split(',').map(Number);
                } else {
                    currentPossibleSupports = [];
                }
            } else {
                skillDescriptionText.textContent = 'Select a skill from the dropdown to see its details.';
                currentPossibleSupports = [];
            }

            // Reset support selections
            supportSelects.forEach(select => select.value = "");
            updateSupportDropdowns(); // Update all support dropdowns
        });

        // Event listeners for each support selection change
        supportSelects.forEach(selectElement => {
            selectElement.addEventListener('change', updateSupportDropdowns);
        });

        // Function to load JSON data
        async function loadJsonData() {
            try {
                // Fetch MercenarySkills.json
                const skillsResponse = await fetch('MercenarySkills.json');
                if (!skillsResponse.ok) {
                    throw new Error(`HTTP error! status: ${skillsResponse.status} for MercenarySkills.json`);
                }
                skills = await skillsResponse.json();

                // Fetch MercenarySupports.json
                const supportsResponse = await fetch('MercenarySupports.json');
                if (!supportsResponse.ok) {
                    throw new Error(`HTTP error! status: ${supportsResponse.status} for MercenarySupports.json`);
                }
                supportGems = await supportsResponse.json();

                // Once data is loaded, populate dropdowns and set initial display
                populateSkillSelect();
                skillDescriptionText.textContent = 'Select a skill from the dropdown to see its details.';
                updateSupportDropdowns(); // Populate initial support options (empty until skill selected)

            } catch (error) {
                console.error('Error loading JSON data:', error);
                skillSelect.innerHTML = '<option value="">Error loading skills</option>';
                skillDescriptionText.textContent = 'Failed to load skill data. Please ensure MercenarySkills.json and MercenarySupports.json are available.';
                supportSelects.forEach(select => select.innerHTML = '<option value="">Error loading supports</option>');
                supportListDisplay.innerHTML = '<p class="error-message">Failed to load support data.</p>';
            }
        }

        // Load data when the DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', loadJsonData);
    </script>
</body>
</html>
